<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç·šä¸ŠèŠå¤©å®¤</title>
    <script type="module">
        // Firebase SDK imports
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.0/firebase-app.js";
        import { 
            getAuth, 
            signInAnonymously, 
            onAuthStateChanged, 
            signInWithCustomToken, 
            signOut 
        } from "https://www.gstatic.com/firebasejs/10.7.0/firebase-auth.js";
        import { 
            getFirestore, 
            collection, 
            addDoc, 
            onSnapshot, 
            query, 
            orderBy, 
            serverTimestamp, 
            doc, 
            setDoc, 
            getDoc, 
            updateDoc, 
            deleteDoc, 
            where, 
            writeBatch 
        } from "https://www.gstatic.com/firebasejs/10.7.0/firebase-firestore.js";

        // Your Firebase config
        const firebaseConfig = {
            apiKey: "AIzaSyBx-TGj56ULPupKwP1YipgQOgyBqwSAnos",
            authDomain: "chatroom-89cc9.firebaseapp.com",
            projectId: "chatroom-89cc9",
            storageBucket: "chatroom-89cc9.firebasestorage.app",
            messagingSenderId: "631226685830",
            appId: "1:631226685830:web:e3d3e0ed3202ff96d6b407",
            measurementId: "G-BEMTWM3XD5"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);
        const appId = 'my-chat-app'; // From original code, adjust if needed

        // Animal list
        const ALL_ANIMALS = [
            "ğŸ¶", "ğŸ±", "ğŸ­", "ğŸ¹", "ğŸ°", "ğŸ¦Š", "ğŸ»", "ğŸ¼", "ğŸ¨", "ğŸ¯", 
            "ğŸ¦", "ğŸ®", "ğŸ·", "ğŸ¸", "ğŸµ", "ğŸ”", "ğŸ§", "ğŸ¦", "ğŸ¦„", "ğŸ™"
        ];

        // Helper functions
        const getAnimalId = (animals) => animals.join('');

        // Global state
        let user = null;
        let animalId = null;
        let userProfile = null;
        let authStep = 'loading';
        let errorMessage = '';
        let kickInfo = null;
        let appName = "ç·šä¸ŠèŠå¤©å®¤";
        let channels = [];
        let currentChannelId = 'general';
        let messages = [];
        let memberList = [];
        let allUsers = {};
        let showAdmin = false;
        let isMobileMenuOpen = false;
        let sidebarView = 'channels';
        let confirmModal = { isOpen: false };
        let alertModal = { isOpen: false };
        let theme = 'dark';

        // DOM elements
        const loginScreen = document.getElementById('login-screen');
        const chatRoom = document.getElementById('chat-room');
        const loadingScreen = document.getElementById('loading-screen');
        const kickedScreen = document.getElementById('kicked-screen');
        const errorDisplay = document.getElementById('error-display');
        const appNameDisplay = document.getElementById('app-name');
        const selectedAnimalsContainer = document.getElementById('selected-animals');
        const animalGrid = document.getElementById('animal-grid');
        const pinInput = document.getElementById('pin-input');
        const nameInput = document.getElementById('name-input');
        const loginButton = document.getElementById('login-button');
        const nextButton = document.getElementById('next-button');
        const resetButton = document.getElementById('reset-button');
        const sidebar = document.getElementById('sidebar');
        const channelList = document.getElementById('channel-list');
        const memberListContainer = document.getElementById('member-list');
        const messageContainer = document.getElementById('message-container');
        const textInput = document.getElementById('text-input');
        const sendButton = document.getElementById('send-button');
        const currentChannelName = document.getElementById('current-channel-name');
        const currentChannelEmoji = document.getElementById('current-channel-emoji');
        const userAvatar = document.getElementById('user-avatar');
        const userName = document.getElementById('user-name');
        const userIdDisplay = document.getElementById('user-id');
        const logoutButton = document.getElementById('logout-button');
        const settingsButton = document.getElementById('settings-button');
        const mobileMenuButton = document.getElementById('mobile-menu-button');
        const closeMobileMenuButton = document.getElementById('close-mobile-menu-button');
        const toggleSidebarViewButton = document.getElementById('toggle-sidebar-view-button');
        const adminPanel = document.getElementById('admin-panel');
        const body = document.body;

        // Selected animals for login
        let selectedAnimals = [];
        let step = 1;

        // Initialize
        function init() {
            // Listen for app name
            onSnapshot(doc(db, 'artifacts', appId, 'public', 'data', 'system', 'config'), (docSnap) => {
                if (docSnap.exists() && docSnap.data().appName) {
                    appName = docSnap.data().appName;
                    appNameDisplay.textContent = appName;
                }
            });

            // Auth init
            signInAnonymously(auth).catch(console.error);
            onAuthStateChanged(auth, (fbUser) => {
                user = fbUser;
                const cachedId = localStorage.getItem(`chat_app_animal_id_${appId}`);
                if (cachedId) {
                    animalId = cachedId;
                } else {
                    setAuthStep('login');
                }
            });

            renderLoginAnimals();
        }

        // Set auth step
        function setAuthStep(step) {
            authStep = step;
            loadingScreen.style.display = step === 'loading' ? 'flex' : 'none';
            loginScreen.style.display = step === 'login' ? 'flex' : 'none';
            chatRoom.style.display = step === 'chat' ? 'flex' : 'none';
            kickedScreen.style.display = step === 'kicked' ? 'flex' : 'none';
            errorDisplay.textContent = errorMessage;
            if (step === 'kicked') {
                document.getElementById('kick-until').textContent = new Date(kickInfo).toLocaleString();
            }
        }

        // Render animals for login
        function renderLoginAnimals() {
            animalGrid.innerHTML = '';
            ALL_ANIMALS.forEach(animal => {
                const button = document.createElement('button');
                button.textContent = animal;
                button.className = 'text-2xl p-2 rounded-xl transition-all relative bg-white/5 hover:bg-white/10 hover:scale-110 active:scale-95';
                button.onclick = () => toggleAnimal(animal);
                animalGrid.appendChild(button);
            });
            renderSelectedAnimals();
        }

        function toggleAnimal(animal) {
            if (selectedAnimals.length < 3) {
                selectedAnimals.push(animal);
                renderSelectedAnimals();
            }
            nextButton.disabled = selectedAnimals.length !== 3;
        }

        function removeAnimal(index) {
            selectedAnimals.splice(index, 1);
            renderSelectedAnimals();
            nextButton.disabled = selectedAnimals.length !== 3;
        }

        function renderSelectedAnimals() {
            selectedAnimalsContainer.innerHTML = '';
            [0, 1, 2].forEach(index => {
                const div = document.createElement('div');
                div.className = `w-16 h-16 rounded-xl flex items-center justify-center text-4xl border-2 transition-all cursor-pointer relative ${
                    index < selectedAnimals.length ? 'bg-fuchsia-600 border-fuchsia-400 shadow-lg shadow-fuchsia-500/30' : 'bg-white/5 border-dashed border-white/20 text-gray-600'
                }`;
                div.textContent = selectedAnimals[index] || '';
                if (index < selectedAnimals.length) {
                    const num = document.createElement('div');
                    num.className = 'absolute -top-2 -right-2 w-6 h-6 bg-white text-fuchsia-600 rounded-full text-xs font-bold flex items-center justify-center border border-fuchsia-200';
                    num.textContent = index + 1;
                    div.appendChild(num);
                    div.onclick = () => removeAnimal(index);
                }
                selectedAnimalsContainer.appendChild(div);
            });
        }

        // Login handler
        async function handleLogin() {
            errorMessage = '';
            if (selectedAnimals.length !== 3) {
                errorMessage = "è«‹é¸æ“‡ 3 å€‹å‹•ç‰©åœ–ç¤ºï¼";
                setAuthStep('login');
                return;
            }
            const pin = pinInput.value;
            const name = nameInput.value;
            if (!pin || pin.length < 4) {
                errorMessage = "PIN ç¢¼è‡³å°‘ 4 ä½æ•¸";
                setAuthStep('login');
                return;
            }
            const targetAnimalId = getAnimalId(selectedAnimals);
            try {
                let currentUser = auth.currentUser;
                if (!currentUser) {
                    const cred = await signInAnonymously(auth);
                    currentUser = cred.user;
                }
                const userDocRef = doc(db, 'artifacts', appId, 'public', 'data', 'users', targetAnimalId);
                const userDocSnap = await getDoc(userDocRef);
                if (userDocSnap.exists()) {
                    const data = userDocSnap.data();
                    if (data.pin !== pin) throw new Error("PIN ç¢¼éŒ¯èª¤ï¼é€™çµ„å‹•ç‰©ä»£ç¢¼å·²è¢«ä½¿ç”¨ã€‚");
                    if (data.kickedUntil && data.kickedUntil > Date.now()) {
                        const until = new Date(data.kickedUntil);
                        throw new Error(`æ‚¨å·²è¢«æš«æ™‚è¸¢å‡ºï¼Œè«‹æ–¼ ${until.toLocaleString()} å¾Œå†è©¦ã€‚`);
                    }
                    await updateDoc(userDocRef, {
                        uid: currentUser.uid,
                        lastLoginAt: serverTimestamp(),
                        lastSeenAt: serverTimestamp()
                    });
                } else {
                    if (!name.trim()) throw new Error("åˆæ¬¡ä½¿ç”¨æ­¤çµ„åˆï¼Œè«‹è¼¸å…¥æ‚¨çš„æš±ç¨±ï¼");
                    const sysRef = doc(db, 'artifacts', appId, 'public', 'data', 'system', 'config');
                    const sysSnap = await getDoc(sysRef);
                    const isFirstUser = !sysSnap.exists();
                    const newProfile = {
                        animalId: targetAnimalId,
                        animals: selectedAnimals,
                        pin: pin,
                        name: name.trim(),
                        avatarUrl: "", 
                        theme: 'dark', 
                        role: isFirstUser ? 'admin' : 'user',
                        uid: currentUser.uid,
                        createdAt: serverTimestamp(),
                        lastSeenAt: serverTimestamp(),
                        isBanned: false 
                    };
                    await setDoc(userDocRef, newProfile);
                    if (isFirstUser) {
                        await setDoc(sysRef, { initialized: true, adminId: targetAnimalId, appName: "ç·šä¸ŠèŠå¤©å®¤" });
                        await setDoc(doc(db, 'artifacts', appId, 'public', 'data', 'channels', 'general'), {
                            name: "ğŸ’¬ ä¸€èˆ¬é–’èŠ",
                            emoji: "ğŸ’¬",
                            createdAt: serverTimestamp(),
                            createdBy: targetAnimalId
                        });
                    }
                }
                localStorage.setItem(`chat_app_animal_id_${appId}`, targetAnimalId);
                animalId = targetAnimalId;
            } catch (e) {
                errorMessage = e.message;
                setAuthStep('login');
            }
        }

        // Listen for profile
        function listenProfile() {
            if (!user || !animalId) return;
            setAuthStep('loading');
            const userDocRef = doc(db, 'artifacts', appId, 'public', 'data', 'users', animalId);
            onSnapshot(userDocRef, (docSnap) => {
                if (docSnap.exists()) {
                    const data = docSnap.data();
                    if (data.uid === user.uid) {
                        const now = Date.now();
                        if (data.kickedUntil && data.kickedUntil > now) {
                            kickInfo = data.kickedUntil;
                            setAuthStep('kicked');
                        } else {
                            userProfile = { theme: 'dark', avatarUrl: '', ...data, id: docSnap.id };
                            theme = userProfile.theme;
                            body.className = theme === 'light' ? 'bg-gray-50 text-gray-900' : 'bg-gray-900 text-gray-100';
                            setAuthStep('chat');
                            renderChat();
                        }
                    } else {
                        handleLogout();
                    }
                } else {
                    handleLogout(); 
                }
            });
        }

        // Heartbeat
        function startHeartbeat() {
            if (authStep !== 'chat' || !userProfile?.id) return;
            const sendHeartbeat = async () => {
                try {
                    await updateDoc(doc(db, 'artifacts', appId, 'public', 'data', 'users', userProfile.id), {
                        lastSeenAt: serverTimestamp()
                    });
                } catch (e) { }
            };
            sendHeartbeat();
            setInterval(sendHeartbeat, 60 * 1000);
        }

        // Logout
        function handleLogout() {
            localStorage.removeItem(`chat_app_animal_id_${appId}`);
            animalId = null;
            userProfile = null;
            setAuthStep('login');
        }

        // Render chat
        function renderChat() {
            // Channels
            onSnapshot(query(collection(db, 'artifacts', appId, 'public', 'data', 'channels')), (snapshot) => {
                channels = snapshot.docs.map(d => ({ id: d.id, ...d.data() }));
                channels.sort((a, b) => (a.createdAt?.seconds || 0) - (b.createdAt?.seconds || 0));
                renderChannels();
                if (channels.length > 0 && !channels.find(c => c.id === currentChannelId)) currentChannelId = channels[0].id;
            });

            // All users
            onSnapshot(query(collection(db, 'artifacts', appId, 'public', 'data', 'users')), (snapshot) => {
                allUsers = {};
                snapshot.forEach(doc => {
                    allUsers[doc.id] = { ...doc.data(), id: doc.id };
                });
            });

            // Sidebar view toggle
            toggleSidebarViewButton.onclick = () => {
                sidebarView = sidebarView === 'channels' ? 'members' : 'channels';
                renderSidebar();
            };

            // Mobile menu
            mobileMenuButton.onclick = () => {
                isMobileMenuOpen = true;
                sidebar.style.transform = 'translateX(0)';
            };
            closeMobileMenuButton.onclick = () => {
                isMobileMenuOpen = false;
                sidebar.style.transform = 'translateX(-100%)';
            };

            // User info
            userName.textContent = userProfile.name;
            userIdDisplay.textContent = `ID: ${userProfile.animals.join('')}`;
            // Avatar would need JS to handle img error, simplify to text for now
            userAvatar.textContent = userProfile.animals[0] || 'U';

            logoutButton.onclick = handleLogout;
            settingsButton.onclick = () => {
                showAdmin = true;
                adminPanel.style.display = 'flex';
            };

            renderSidebar();
            listenMessages();
            startHeartbeat();
        }

        // Render sidebar
        function renderSidebar() {
            if (sidebarView === 'channels') {
                renderChannels();
                channelList.style.display = 'block';
                memberListContainer.style.display = 'none';
            } else {
                renderMembers();
                channelList.style.display = 'none';
                memberListContainer.style.display = 'block';
            }
        }

        // Render channels
        function renderChannels() {
            channelList.innerHTML = '';
            channels.forEach(ch => {
                const button = document.createElement('button');
                button.className = `w-full text-left px-4 py-3 rounded-xl transition-all flex items-center ${currentChannelId === ch.id ? 'bg-fuchsia-600 text-white' : 'text-gray-400 hover:bg-white/5'}`;
                button.innerHTML = `<span class="mr-3 text-lg">${ch.emoji}</span><span class="truncate">${ch.name}</span>`;
                button.onclick = () => {
                    currentChannelId = ch.id;
                    renderChannels();
                    renderCurrentChannel();
                    listenMessages();
                    if (isMobileMenuOpen) {
                        isMobileMenuOpen = false;
                        sidebar.style.transform = 'translateX(-100%)';
                    }
                };
                channelList.appendChild(button);
            });
            renderCurrentChannel();
        }

        // Render current channel
        function renderCurrentChannel() {
            const current = channels.find(c => c.id === currentChannelId) || { name: 'Loading...', emoji: 'â³' };
            currentChannelEmoji.textContent = current.emoji;
            currentChannelName.textContent = current.name;
            textInput.placeholder = `åœ¨ #${current.name} ç™¼è¨€...`;
        }

        // Render members
        function renderMembers() {
            memberListContainer.innerHTML = '';
            onSnapshot(collection(db, 'artifacts', appId, 'public', 'data', 'users'), (snapshot) => {
                memberList = snapshot.docs.map(d => ({ id: d.id, ...d.data() }));
                memberList.sort((a, b) => (b.lastSeenAt?.seconds || 0) - (a.lastSeenAt?.seconds || 0));
                memberList.forEach(m => {
                    const div = document.createElement('div');
                    const isMe = m.id === userProfile.id;
                    const isOnline = Date.now() - (m.lastSeenAt?.seconds * 1000 || 0) < 3 * 60 * 1000;
                    div.className = 'flex items-center gap-3 px-4 py-3 rounded-xl hover:bg-white/5 group';
                    div.innerHTML = `
                        <div class="w-8 h-8 rounded-full bg-gradient-to-br from-gray-700 to-gray-600 flex items-center justify-center border border-white/10 shadow-sm">${m.animals?.[0] || 'U'}</div>
                        <div class="truncate flex-1">
                            <div class="text-sm font-medium flex items-center gap-1">
                                ${m.name}
                                ${m.role === 'admin' ? '<span class="text-[10px] bg-red-600 text-white px-1 rounded">ADM</span>' : ''}
                            </div>
                            <div class="text-[10px] text-gray-400">
                                ${isMe ? '<span class="text-fuchsia-500 font-bold">â— æ‚¨è‡ªå·±</span>' : isOnline ? '<span class="text-green-500 font-bold">â— ç·šä¸Š</span>' : 'é›¢ç·š'}
                            </div>
                        </div>
                    `;
                    memberListContainer.appendChild(div);
                });
            });
        }

        // Listen messages
        function listenMessages() {
            onSnapshot(query(collection(db, 'artifacts', appId, 'public', 'data', 'messages')), (snapshot) => {
                let msgs = snapshot.docs.map(d => ({ id: d.id, ...d.data() }));
                msgs = msgs.filter(m => m.channelId === currentChannelId);
                msgs.sort((a, b) => (a.timestamp || 0) - (b.timestamp || 0));
                messages = msgs;
                renderMessages();
            });
        }

        // Render messages
        function renderMessages() {
            messageContainer.innerHTML = '';
            messages.forEach(msg => {
                const isMe = msg.senderId === userProfile.id;
                const canDelete = isMe || userProfile.role === 'admin';
                const senderUser = allUsers[msg.senderId] || {};
                let liveName = isMe ? userProfile.name : senderUser.name || msg.senderName;
                let liveAvatarUrl = isMe ? userProfile.avatarUrl : senderUser.avatarUrl || msg.senderAvatarUrl;
                const div = document.createElement('div');
                div.className = `flex gap-3 group ${isMe ? 'flex-row-reverse' : ''}`;
                div.innerHTML = `
                    <div class="w-8 h-8 rounded-full bg-gradient-to-br from-gray-700 to-gray-600 flex items-center justify-center border border-white/10 shadow-sm mt-1">${msg.senderAnimal || 'U'}</div>
                    <div class="max-w-[80%] flex flex-col ${isMe ? 'items-end' : 'items-start'}">
                        <div class="flex items-center gap-2 mb-1">
                            <span class="text-xs font-bold text-gray-400">${liveName}</span>
                            <span class="text-[10px] text-gray-400">${new Date(msg.timestamp).toLocaleTimeString([], {hour:'2-digit',minute:'2-digit'})}</span>
                        </div>
                        <div class="relative p-3 rounded-2xl text-sm leading-relaxed ${isMe ? 'bg-fuchsia-600 text-white rounded-tr-none' : 'bg-gray-800 text-gray-200 rounded-tl-none'}">
                            ${msg.text}
                            ${canDelete ? `<button onclick="deleteMessage('${msg.id}')" class="absolute -top-2 -right-2 bg-red-600 text-white p-1 rounded-full opacity-0 group-hover:opacity-100 transition-opacity shadow-sm">X</button>` : ''}
                        </div>
                    </div>
                `;
                messageContainer.appendChild(div);
            });
            messageContainer.scrollTop = messageContainer.scrollHeight;
        }

        // Delete message
        async function deleteMessage(msgId) {
            if (confirm('ç¢ºå®šè¦åˆªé™¤é€™å‰‡è¨Šæ¯å—ï¼Ÿ')) {
                await deleteDoc(doc(db, 'artifacts', appId, 'public', 'data', 'messages', msgId));
            }
        }

        // Send message
        async function handleSend() {
            const text = textInput.value.trim();
            if (!text) return;
            await addDoc(collection(db, 'artifacts', appId, 'public', 'data', 'messages'), {
                text,
                channelId: currentChannelId,
                senderId: userProfile.id, 
                senderName: userProfile.name,
                senderAvatarUrl: userProfile.avatarUrl || "", 
                senderAnimal: userProfile.animals[0],
                senderUid: user.uid,
                timestamp: Date.now(),
                type: 'text'
            });
            textInput.value = '';
            await updateDoc(doc(db, 'artifacts', appId, 'public', 'data', 'users', userProfile.id), { lastSeenAt: serverTimestamp() });
        }

        // Next step in login
        nextButton.onclick = () => {
            step = 2;
            document.getElementById('step1').style.display = 'none';
            document.getElementById('step2').style.display = 'block';
        };

        // Reset to step 1
        resetButton.onclick = () => {
            step = 1;
            document.getElementById('step1').style.display = 'block';
            document.getElementById('step2').style.display = 'none';
        };

        // Login button
        loginButton.onclick = async () => {
            await handleLogin();
            listenProfile();
        };

        // Send button
        sendButton.onclick = handleSend;

        // Admin panel (simplified, add more if needed)
        // For admin panel, you can add similar logic, but to keep it short, assume basic functionality
        adminPanel.onclick = (e) => {
            if (e.target === adminPanel) {
                showAdmin = false;
                adminPanel.style.display = 'none';
            }
        };

        // Init on load
        window.onload = init;
    </script>
    <style>
        /* Add CSS from original, simplified */
        body { min-height: 100vh; font-family: sans-serif; transition: all 0.3s; }
        .custom-scrollbar { scrollbar-width: thin; }
        .custom-scrollbar::-webkit-scrollbar { width: 6px; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background-color: rgba(255,255,255,0.2); border-radius: 10px; }
        /* More CSS as needed */
    </style>
</head>
<body class="bg-gray-900 text-gray-100">
    <div id="loading-screen" class="flex items-center justify-center h-screen text-fuchsia-500">Loading...</div>
    <div id="kicked-screen" class="hidden flex flex-col items-center justify-center h-screen text-red-500 space-y-6 p-6 text-center">
        <h1 class="text-3xl font-bold mb-2">æ‚¨å·²è¢«æš«æ™‚è¸¢å‡º</h1>
        <p class="text-gray-400">ç®¡ç†å“¡å·²é™åˆ¶æ‚¨çš„è¨ªå•æ¬Šé™</p>
        <p class="text-red-400 mt-2 font-mono bg-black/40 py-2 px-4 rounded-lg inline-block">è§£é–æ™‚é–“ï¼š<span id="kick-until"></span></p>
        <button onclick="handleLogout()" class="px-6 py-3 bg-gray-800 rounded-xl hover:bg-gray-700 text-white transition-colors">è¿”å›é¦–é </button>
    </div>
    <div id="login-screen" class="hidden min-h-screen flex items-center justify-center p-4">
        <div class="w-full max-w-2xl bg-black/40 backdrop-blur-xl border border-white/10 p-6 rounded-3xl shadow-2xl">
            <h1 id="app-name" class="text-3xl font-bold text-center mb-2 bg-gradient-to-r from-fuchsia-400 to-purple-400 bg-clip-text text-transparent">ç·šä¸ŠèŠå¤©å®¤</h1>
            <p class="text-gray-400 text-center text-sm mb-6">è«‹é¸æ“‡ 3 å€‹å‹•ç‰©ä½œç‚ºæ‚¨çš„ã€Œç™»å…¥ IDã€</p>
            <div id="error-display" class="text-red-400 text-xs text-center p-2 bg-red-900/20 rounded-lg"></div>
            <div id="step1">
                <div id="selected-animals" class="flex justify-center gap-4 mb-6 min-h-[80px] items-center bg-black/30 rounded-xl p-4 border border-white/5"></div>
                <div id="animal-grid" class="grid grid-cols-5 sm:grid-cols-8 gap-2 max-h-[40vh] overflow-y-auto p-2 custom-scrollbar"></div>
                <div class="mt-6 flex justify-center">
                    <button id="next-button" disabled class="bg-fuchsia-600 hover:bg-fuchsia-500 text-white font-bold py-3 px-12 rounded-xl disabled:opacity-50 disabled:cursor-not-allowed transition-all">ä¸‹ä¸€æ­¥</button>
                </div>
            </div>
            <div id="step2" style="display:none;" class="max-w-xs mx-auto space-y-4">
                <div class="flex justify-center gap-2 mb-4 text-4xl"></div> <!-- Selected animals display -->
                <div>
                    <label class="text-xs text-gray-400 ml-1">PIN ç¢¼</label>
                    <input id="pin-input" type="text" placeholder="4-8 ä½æ•¸å­—" class="w-full bg-black/50 border border-white/10 rounded-xl px-4 py-3 text-center text-xl tracking-[0.5em] focus:outline-none focus:border-fuchsia-500 transition-colors">
                </div>
                <div>
                    <label class="text-xs text-gray-400 ml-1">æš±ç¨± (é¡¯ç¤ºåç¨±)</label>
                    <input id="name-input" type="text" placeholder="æ€éº¼ç¨±å‘¼æ‚¨ï¼Ÿ" class="w-full bg-black/50 border border-white/10 rounded-xl px-4 py-3 text-center focus:outline-none focus:border-fuchsia-500 transition-colors">
                </div>
                <div class="flex gap-2 pt-2">
                    <button id="reset-button" class="flex-1 bg-gray-700 text-white py-3 rounded-xl hover:bg-gray-600 transition-colors">é‡é¸</button>
                    <button id="login-button" class="flex-[2] bg-fuchsia-600 hover:bg-fuchsia-500 text-white font-bold py-3 rounded-xl shadow-lg shadow-fuchsia-900/20 flex items-center justify-center gap-2 transition-all">é€²å…¥</button>
                </div>
            </div>
        </div>
    </div>
    <div id="chat-room" class="hidden flex h-screen overflow-hidden relative">
        <aside id="sidebar" class="fixed inset-y-0 left-0 z-20 w-64 bg-black/80 backdrop-blur border-r border-white/10 transform transition-transform duration-200 md:relative md:translate-x-0 -translate-x-full">
            <div class="p-4 border-b border-white/10 flex justify-between items-center">
                <h2 class="font-bold text-lg text-fuchsia-500 truncate">ç·šä¸ŠèŠå¤©å®¤</h2>
                <div class="flex gap-2">
                    <button id="toggle-sidebar-view-button" class="p-2 rounded-lg transition-colors hover:bg-white/5">U</button> <!-- Icon placeholder -->
                    <button id="close-mobile-menu-button" class="md:hidden">X</button>
                </div>
            </div>
            <div class="flex-1 overflow-y-auto p-2 space-y-1 custom-scrollbar">
                <div id="channel-list"></div>
                <div id="member-list" style="display:none;"></div>
            </div>
            <div class="p-4 border-t border-white/10 bg-black/5">
                <div class="flex items-center gap-3 mb-4">
                    <div id="user-avatar" class="w-10 h-10 rounded-full bg-gradient-to-br from-gray-700 to-gray-600 flex items-center justify-center border border-white/10 shadow-sm"></div>
                    <div class="overflow-hidden">
                        <div id="user-name" class="font-bold text-sm truncate"></div>
                        <div id="user-id" class="text-[10px] text-gray-400"></div>
                    </div>
                </div>
                <div class="grid grid-cols-2 gap-2">
                    <button id="settings-button" class="py-2 rounded-lg text-xs flex items-center justify-center gap-1 hover:bg-white/5">è¨­å®š</button>
                    <button id="logout-button" class="bg-red-900/10 text-red-500 py-2 rounded-lg text-xs flex items-center justify-center gap-1 hover:bg-red-900/20">ç™»å‡º</button>
                </div>
            </div>
        </aside>
        <main class="flex-1 flex flex-col w-full relative">
            <header class="h-16 border-b border-white/10 bg-black/40 backdrop-blur flex items-center px-4 justify-between z-10">
                <div class="flex items-center gap-3">
                    <button id="mobile-menu-button" class="md:hidden">Menu</button>
                    <span id="current-channel-emoji" class="text-2xl"></span>
                    <h1 id="current-channel-name" class="font-bold truncate"></h1>
                </div>
            </header>
            <div id="message-container" class="flex-1 overflow-y-auto p-4 space-y-4 custom-scrollbar"></div>
            <div class="p-4 bg-black/40 border-t border-white/10 backdrop-blur">
                <form class="flex gap-2 max-w-4xl mx-auto">
                    <input id="text-input" placeholder="ç™¼è¨€..." class="flex-1 bg-black/50 border border-white/10 rounded-xl px-4 py-3 focus:outline-none focus:border-fuchsia-500 transition-colors text-gray-100">
                    <button id="send-button" class="bg-fuchsia-600 hover:bg-fuchsia-500 text-white p-3 rounded-xl transition-colors">Send</button>
                </form>
            </div>
        </main>
        <div id="admin-panel" class="hidden fixed inset-0 bg-black/80 z-50 flex items-center justify-center p-4">
            <!-- Admin panel content, add as needed -->
            <div class="bg-gray-800 border border-white/10 rounded-2xl p-6 max-w-4xl w-full h-[80vh] overflow-auto">
                <h2>ç®¡ç†é¢æ¿</h2>
                <!-- Add tabs and forms here -->
            </div>
        </div>
    </div>
</body>
</html>
